{"version":3,"sources":["../src/sink.js"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;;;;;;;IAEqB,I;;;AACnB,gBAAY,kBAAZ,EAA0F;AAAA,QAA1D,kBAA0D,uEAArC,SAAqC;AAAA,QAA1B,YAA0B,uEAAX,SAAW;;AAAA;;AAAA,4GAClF,kBADkF,EAC9D,kBAD8D,EAC1C,YAD0C;;AAGxF,QAAM,aAAa,MAAK,IAAL,CAAU,aAAV,CAAwB,MAAK,kBAA7B,CAAnB;AACA,eAAW,gBAAX,CAA4B,UAA5B,EAAwC,MAAK,UAAL,CAAgB,IAAhB,OAAxC;AACA,eAAW,gBAAX,CAA4B,WAA5B,EAAyC,MAAK,WAAL,CAAiB,IAAjB,OAAzC;AACA;AACA,eAAW,gBAAX,CAA4B,SAA5B,EAAuC,MAAK,SAAL,CAAe,IAAf,OAAvC;AACA,eAAW,gBAAX,CAA4B,MAA5B,EAAoC,MAAK,MAAL,CAAY,IAAZ,OAApC;;AARwF;AAAA;AAAA;;AAAA;AAUxF,2BAAmB,WAAW,gBAAX,CAA4B,MAAK,YAAjC,CAAnB,8HAAmE;AAAA,YAAxD,IAAwD;;AACjE,cAAK,KAAL,CAAW,IAAX;AACD;AAZuF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAazF;;;;0BAEK,I,EAAM;AACV,wGAAY,IAAZ;;AAEA,WAAK,YAAL,CAAkB,WAAlB,EAA+B,IAA/B;AACA,WAAK,YAAL,CAAkB,UAAlB,EAA8B,CAA9B;AACA,WAAK,gBAAL,CAAsB,WAAtB,EAAmC,KAAK,WAAL,CAAiB,IAAjB,CAAsB,IAAtB,CAAnC;AACA,WAAK,gBAAL,CAAsB,SAAtB,EAAiC,KAAK,UAAL,CAAgB,IAAhB,CAAqB,IAArB,CAAjC;AACD;;;gCAEW,K,EAAO;AACjB,YAAM,YAAN,CAAmB,OAAnB,CAA2B,MAA3B,EAAmC,MAAM,MAAN,CAAa,SAAhD;AACA,YAAM,YAAN,CAAmB,aAAnB,GAAmC,MAAnC;AACA,YAAM,YAAN,CAAmB,UAAnB,GAAgC,MAAhC;AACD;;;+BAEU,K,EAAO;AAChB,YAAM,MAAN,CAAa,MAAb;AACD;;;+BAEU,K,EAAO;AAChB,YAAM,cAAN;AACA,YAAM,eAAN;AACA,aAAO,KAAP;AACD;;;gCAEW,K,EAAO;AACjB,YAAM,cAAN;AACA,YAAM,eAAN;;AAFiB;AAAA;AAAA;;AAAA;AAIjB,8BAAmB,KAAK,IAAL,CAAU,gBAAV,CAA2B,OAA3B,CAAnB,mIAAwD;AAAA,cAA7C,IAA6C;;AACtD,eAAK,SAAL,CAAe,MAAf,CAAsB,MAAtB;AACD;AANgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAQjB,UAAI,SAAS,MAAM,MAAnB;AACA,UAAI,OAAO,OAAO,OAAd,KAA0B,UAA9B,EAA0C;AAC1C,aAAO,CAAC,OAAO,OAAP,CAAe,KAAK,YAAL,GAAoB,aAAnC,CAAR,EAA2D;AAAE;AAC3D,iBAAS,OAAO,UAAhB;AACA,YAAI,CAAC,MAAL,EAAa;AACb,YAAI,OAAO,OAAO,OAAd,KAA0B,UAA9B,EAA0C;AAC3C;;AAED,aAAO,SAAP,CAAiB,GAAjB,CAAqB,MAArB;AACD;;AAED;;;;8BAEU,K,EAAO;AAAA;AAAA;AAAA;;AAAA;AACf,8BAAmB,KAAK,IAAL,CAAU,gBAAV,CAA2B,OAA3B,CAAnB,mIAAwD;AAAA,cAA7C,IAA6C;;AACtD,eAAK,SAAL,CAAe,MAAf,CAAsB,MAAtB;AACD;AAHc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIhB;;;2BAEM,K,EAAO;AACZ,YAAM,cAAN;AACA,UAAM,OAAO,MAAM,YAAN,CAAmB,OAAnB,CAA2B,MAA3B,CAAb;;AAEA,UAAI,SAAS,MAAM,MAAnB;;AAEA,UAAM,UAAU,SAAS,aAAT,CAAuB,KAAvB,CAAhB;AACA,cAAQ,SAAR,GAAoB,IAApB;AACA,UAAM,OAAO,QAAQ,QAAR,CAAiB,CAAjB,CAAb;;AAEA,UAAI,OAAO,QAAP,KAAoB,SAAxB,EAAmC;AAAE;AACnC,eAAO,WAAP,CAAmB,IAAnB;AACA,aAAK,KAAL,CAAW,IAAX;AACD,OAHD,MAGO;AACL,eAAO,CAAC,OAAO,OAAP,CAAe,KAAK,YAAL,GAAoB,aAAnC,CAAR,EAA2D;AAAE;AAC3D,mBAAS,OAAO,UAAhB;AACD;;AAED,eAAO,UAAP,CAAkB,YAAlB,CAA+B,IAA/B,EAAqC,MAArC;AACA,aAAK,KAAL,CAAW,IAAX;AACD;;AAED,WAAK,SAAL;AACD;;;;;;kBA3FkB,I","file":"sink.js","sourcesContent":["import Player from './player';\n\nexport default class Sink extends Player {\n  constructor(rootNodeOrSelector, collectionSelector = 'article', itemSelector = 'section') {\n    super(rootNodeOrSelector, collectionSelector, itemSelector);\n\n    const collection = this.root.querySelector(this.collectionSelector);\n    collection.addEventListener('dragover', this.onDragOver.bind(this));\n    collection.addEventListener('dragenter', this.onDragEnter.bind(this));\n    // collection.addEventListener('dragleave', this.onDragLeave.bind(this));\n    collection.addEventListener('dragend', this.onDragEnd.bind(this));\n    collection.addEventListener('drop', this.onDrop.bind(this));\n\n    for (const item of collection.querySelectorAll(this.itemSelector)) {\n      this.setup(item);\n    }\n  }\n\n  setup(item) {\n    super.setup(item);\n\n    item.setAttribute('draggable', true);\n    item.setAttribute('tabindex', 0);\n    item.addEventListener('dragstart', this.onDragStart.bind(this));\n    item.addEventListener('dragend', this.onDragEnd2.bind(this));\n  }\n\n  onDragStart(event) {\n    event.dataTransfer.setData('html', event.target.outerHTML);\n    event.dataTransfer.effectAllowed = 'copy';\n    event.dataTransfer.dropEffect = 'copy';\n  }\n\n  onDragEnd2(event) {\n    event.target.remove();\n  }\n\n  onDragOver(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    return false;\n  }\n\n  onDragEnter(event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    for (const item of this.root.querySelectorAll('.over')) {\n      item.classList.remove('over');\n    }\n\n    let target = event.target;\n    if (typeof target.matches !== 'function') return;\n    while (!target.matches(this.itemSelector + '[draggable]')) { // FIXME\n      target = target.parentNode;\n      if (!target) return;\n      if (typeof target.matches !== 'function') return;\n    }\n\n    target.classList.add('over');\n  }\n\n  // onDragLeave(event) {}\n\n  onDragEnd(event) {\n    for (const item of this.root.querySelectorAll('.over')) {\n      item.classList.remove('over');\n    }\n  }\n\n  onDrop(event) {\n    event.preventDefault();\n    const html = event.dataTransfer.getData('html');\n\n    let target = event.target;\n\n    const wrapper = document.createElement('div');\n    wrapper.innerHTML = html;\n    const item = wrapper.children[0];\n\n    if (target.nodeName === 'ARTICLE') { // FIXME\n      target.appendChild(item);\n      this.setup(item);\n    } else {\n      while (!target.matches(this.itemSelector + '[draggable]')) { // FIXME\n        target = target.parentNode;\n      }\n\n      target.parentNode.insertBefore(item, target);\n      this.setup(item);\n    }\n\n    this.onDragEnd();\n  }\n}\n"]}