{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["class Player {\n  constructor(nodeOrSelector) {\n    this.node = typeof nodeOrSelector === 'string' ? document.querySelector(nodeOrSelector) : nodeOrSelector;\n  }\n}\n\nclass Source extends Player {\n  constructor(nodeOrSelector) {\n    super(nodeOrSelector);\n\n    document.addEventListener('selectionchange', this.onSelectionChange.bind(this));\n    document.addEventListener('mouseup', this.onMouseUp.bind(this));\n  }\n\n  onSelectionChange() {\n    const selection = window.getSelection();\n    if (selection.rangeCount === 0) return;\n\n    const range = selection.getRangeAt(0);\n    const commonAncestor = range.commonAncestorContainer;\n\n    if (commonAncestor.nodeType === document.TEXT_NODE) {\n      range.setStartBefore(commonAncestor.parentNode);\n      return;\n    }\n\n    if (!(commonAncestor.matches('section[data-src]') || commonAncestor.parentNode.matches('section[data-src]'))) return;\n\n    for (const selected of this.node.querySelectorAll('.selected')) {\n      if (selection.containsNode(selected, true)) continue;\n      selected.classList.remove('selected');\n      selected.removeAttribute('draggable');\n    }\n\n    for (const candidate of commonAncestor.getElementsByTagName('*')) {\n      if (selection.containsNode(candidate, true) && candidate.nodeName !== 'P') {\n        candidate.classList.add('selected');\n      }\n    }\n  }\n\n  onMouseUp() {\n    const selection = window.getSelection();\n    const selected = this.node.querySelectorAll('.selected');\n\n    for (const node of selected) {\n      if (selection.containsNode(node, true)) {\n        node.setAttribute('draggable', true);\n        node.addEventListener('dragstart', this.onDragStart.bind(this));\n        node.addEventListener('dragend', this.onDragEnd.bind(this));\n      } else {\n        node.classList.remove('selected');\n        node.removeAttribute('draggable');\n      }\n    }\n\n    const range = selection.getRangeAt(0);\n    if (selected.length > 0) {\n      range.setStartBefore(selected.item(0));\n      range.setEndAfter(selected.item(selected.length - 1));\n    } else selection.removeAllRanges();\n  }\n\n  onDragStart(event) {\n    event.dataTransfer.setData('nodes', this.node.querySelectorAll('.selected'));\n    event.dataTransfer.effectAllowed = 'copy';\n    event.dataTransfer.dropEffect = 'copy';\n  }\n\n  onDragEnd() {\n    for (const node of this.node.querySelectorAll('.selected')) {\n      node.classList.remove('selected');\n      node.removeAttribute('draggable');\n    }\n  }\n}\n\n\nclass Sink extends Player {\n  constructor(nodeOrSelector) {\n    super(nodeOrSelector);\n\n    this.node.querySelector('article').addEventListener('dragover', this.onDragOver.bind(this));\n    this.node.querySelector('article').addEventListener('dragenter', this.onDragEnter.bind(this));\n    // this.node.querySelector('article').addEventListener('dragleave', this.onDragLeave.bind(this));\n    this.node.querySelector('article').addEventListener('dragend', this.onDragEnd.bind(this));\n    this.node.querySelector('article').addEventListener('drop', this.onDrop.bind(this));\n  }\n\n  onDragOver(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    return false;\n  }\n\n  onDragEnter(event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    for (const node of this.node.querySelectorAll('.over')) {\n      node.classList.remove('over');\n    }\n\n    let target = event.target;\n    if (typeof target.matches !== 'function') return;\n    while (!target.matches('section[data-src]')) {\n      console.log(target);\n      target = target.parentNode;\n      if (!target) return;\n      if (typeof target.matches !== 'function') return;\n    }\n\n    target.classList.add('over');\n  }\n\n  // onDragLeave(event) {}\n\n  onDragEnd(event) {\n    for (const node of this.node.querySelectorAll('.over')) {\n      node.classList.remove('over');\n    }\n  }\n\n  onDrop(event) {\n    event.preventDefault();\n    console.log(event.dataTransfer.getData('nodes'));\n  }\n}\n"]}