{"version":3,"sources":["webpack:///bundle.js","webpack:///webpack/bootstrap 3ba3e06de3cfe0d5a75b","webpack:///./src/player.js","webpack:///./src/source.js","webpack:///./src/sink.js","webpack:///./src/loader.js","webpack:///./src/hyperaudio.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_classCallCheck","instance","Constructor","TypeError","value","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","undefined","_s","_i","Symbol","iterator","next","done","push","length","err","Array","isArray","_createClass","defineProperties","target","props","descriptor","writable","key","protoProps","staticProps","Player","rootNodeOrSelector","_this","this","itemSelector","arguments","root","document","querySelector","createElement","parentNode","querySelectorAll","forEach","item","setup","addEventListener","onClick","bind","src","getAttribute","type","getMedia","element","t","parseInt","setAttribute","join","removeAttribute","event","matches","media","_t$split","split","_t$split2","start","currentTime","paused","play","time","_this2","currentSrc","found","items","j","active","classList","remove","candidates","first","last","_first$getAttribute$s","_first$getAttribute$s2","t0","parseFloat","_last$getAttribute$sp","_last$getAttribute$sp2","ti","di","lastSegment","tc","_tc$split","_tc$split2","add","contains","setInterval","pause","allItems","k","createEvent","initEvent","dispatchEvent","setHead","source","style","display","wrapper","splice","pop","innerHTML","appendChild","findMedia","createMedia","hideOtherMediaThan","onTimeUpdate","default","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","_player","_player2","obj","Source","_Player","getPrototypeOf","onSelectionChange","collection","onMouseUp","selection","window","getSelection","rangeCount","range","getRangeAt","startOffset","endOffset","commonAncestor","commonAncestorContainer","nodeType","setStartBefore","selected","containsNode","candidate","nodeName","node","onDragStart","onDragEnd","removeAllRanges","parent","prevSelected","clone","cloneNode","dataTransfer","setData","outerHTML","innerText","effectAllowed","dropEffect","itemClone","setDragImage","_get","receiver","Function","desc","getOwnPropertyDescriptor","Sink","onDragOver","onDragEnter","onDrop","onDragEnd2","preventDefault","stopPropagation","html","getData","children","insertBefore","_interopRequireDefault","_source","_source2","_sink","_sink2","_hyperaudio","_hyperaudio2","Hyperaudio","hyperaudio","sourceNode","sinkNode","playerNode"],"mappings":"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","file":"bundle.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"http://localhost:5555/dist/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 3);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* eslint-disable class-methods-use-this, no-unused-vars, no-plusplus, no-continue, no-param-reassign */\n\nvar Player = function () {\n  function Player(rootNodeOrSelector) {\n    var _this = this;\n\n    var itemSelector = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.hyperaudio-transcript, .hyperaudio-effect';\n\n    _classCallCheck(this, Player);\n\n    this.itemSelector = itemSelector;\n    this.root = typeof rootNodeOrSelector === 'string' ? document.querySelector(rootNodeOrSelector) || document.createElement('section') : rootNodeOrSelector;\n\n    // flow-disable-next-line\n    this.root.querySelector(this.itemSelector).parentNode.querySelectorAll(this.itemSelector).forEach(function (item) {\n      return _this.setup(item);\n    });\n\n    // flow-disable-next-line\n    this.root.querySelector(this.itemSelector).parentNode.addEventListener('click', this.onClick.bind(this));\n  }\n\n  _createClass(Player, [{\n    key: 'setup',\n    value: function setup(item) {\n      var src = item.getAttribute('data-src');\n      var type = item.getAttribute('data-type');\n\n      if (src) this.getMedia(src, type);\n\n      // data-m?\n      item.querySelectorAll('*[data-m]').forEach(function (element) {\n        var m = element.getAttribute('data-m');\n        var d = element.getAttribute('data-d');\n        var t = [];\n\n        if (m) t.push(parseInt(m, 10) / 1000);\n        if (d) t.push(parseInt(d, 10) / 1000);\n\n        element.setAttribute('data-t', t.join(','));\n        element.removeAttribute('data-m');\n        element.removeAttribute('data-d');\n        element.removeAttribute('class');\n        element.parentNode.removeAttribute('class');\n      });\n    }\n\n    // empty() {\n    //   this.root.querySelector(this.itemSelector).parentNode.innerHTML = '';\n    //   this.root.querySelector('header').parentNode.innerHTML = '';\n    // }\n\n  }, {\n    key: 'onClick',\n    value: function onClick(event) {\n      var t = event.target.getAttribute('data-t');\n      if (!t) return;\n\n      var item = event.target.parentNode;\n      while (item && !item.matches(this.itemSelector)) {\n        item = item.parentNode;\n      }if (!item) return;\n\n      var src = item.getAttribute('data-src');\n      if (!src) return;\n\n      // FIXME\n      // flow-disable-next-line\n      var media = this.getMedia(src);\n      if (!media) return;\n\n      var _t$split = t.split(','),\n          _t$split2 = _slicedToArray(_t$split, 2),\n          start = _t$split2[0],\n          duration = _t$split2[1];\n      // event.target.classList.add('hyperaudio-duration');\n\n      // flow-disable-next-line\n\n\n      media.currentTime = start;\n\n      // flow-disable-next-line\n      if (media.paused) media.play();\n    }\n  }, {\n    key: 'setHead',\n    value: function setHead(time, src) {\n      var _this2 = this;\n\n      this.currentSrc = src;\n      var found = false;\n\n      var items = this.root.querySelectorAll('.hyperaudio-transcript[data-src=\"' + src + '\"]');\n\n      var _loop = function _loop(j) {\n        var item = items[j];\n\n        item.querySelectorAll('.hyperaudio-past').forEach(function (active) {\n          return active.classList.remove('hyperaudio-past');\n        });\n        item.querySelectorAll('.hyperaudio-active').forEach(function (active) {\n          return active.classList.remove('hyperaudio-active');\n        });\n\n        var candidates = item.querySelectorAll('*[data-t]');\n\n        var first = candidates[0];\n        var last = candidates[candidates.length - 1];\n\n        // flow-disable-next-line\n\n        var _first$getAttribute$s = first.getAttribute('data-t').split(','),\n            _first$getAttribute$s2 = _slicedToArray(_first$getAttribute$s, 1),\n            t0 = _first$getAttribute$s2[0];\n\n        if (time < parseFloat(t0)) return 'continue';\n\n        // flow-disable-next-line\n\n        var _last$getAttribute$sp = last.getAttribute('data-t').split(','),\n            _last$getAttribute$sp2 = _slicedToArray(_last$getAttribute$sp, 2),\n            ti = _last$getAttribute$sp2[0],\n            di = _last$getAttribute$sp2[1];\n\n        if (time > parseFloat(ti) + parseFloat(di)) return 'continue';\n\n        found = true;\n        _this2.lastSegment = item;\n\n        var _loop2 = function _loop2(i) {\n          var tc = candidates[i].getAttribute('data-t');\n          // flow-disable-next-line\n\n          var _tc$split = tc.split(','),\n              _tc$split2 = _slicedToArray(_tc$split, 2),\n              t = _tc$split2[0],\n              d = _tc$split2[1];\n\n          t = parseFloat(t);\n          d = parseFloat(d);\n\n          if (t < time) {\n            candidates[i].classList.add('hyperaudio-past');\n          }\n\n          if (t <= time && time < t + d) {\n            // console.log(time - (t + d) * 1e3);\n            candidates[i].classList.add('hyperaudio-active');\n            if (!candidates[i].classList.contains('hyperaudio-duration')) setInterval(function () {\n              candidates[i].classList.remove('hyperaudio-duration');\n            }, (d - (time - t)) * 1e3);\n            candidates[i].classList.add('hyperaudio-duration');\n          }\n\n          if (t > time) return 'break';\n        };\n\n        for (var i = 0; i < candidates.length; i++) {\n          var _ret2 = _loop2(i);\n\n          if (_ret2 === 'break') break;\n        }\n      };\n\n      for (var j = 0; j < items.length; j++) {\n        var _ret = _loop(j);\n\n        if (_ret === 'continue') continue;\n      }\n\n      if (!found) {\n        // flow-disable-next-line\n        var media = this.getMedia(src);\n        // flow-disable-next-line\n        media.pause();\n\n        var allItems = this.root.querySelectorAll('.hyperaudio-transcript');\n        for (var k = 0; k < allItems.length - 1; k++) {\n          if (allItems[k] === this.lastSegment) {\n            var event = document.createEvent('HTMLEvents');\n            event.initEvent('click', true, false);\n            // flow-disable-next-line\n            allItems[k + 1].querySelector('*[data-t]').dispatchEvent(event);\n            break;\n          }\n        }\n      }\n    }\n  }, {\n    key: 'onTimeUpdate',\n    value: function onTimeUpdate(event) {\n      var time = event.target.currentTime;\n      var src = event.target.getAttribute('data-src');\n      this.setHead(time, src);\n    }\n  }, {\n    key: 'findMedia',\n    value: function findMedia(src) {\n      var media = this.root.querySelector('video[src=\"' + src + '\"], audio[src=\"' + src + '\"]');\n      if (!media) {\n        var source = this.root.querySelector('source[src=\"' + src + '\"], source[src=\"' + src + '\"]');\n        if (source) media = source.parentNode;\n      }\n\n      return media;\n    }\n  }, {\n    key: 'hideOtherMediaThan',\n    value: function hideOtherMediaThan(src) {\n      this.root.querySelectorAll('video:not([src=\"' + src + '\"]), audio:not([src=\"' + src + '\"])').forEach(function (media) {\n        // flow-disable-next-line\n        media.pause();\n        media.style.display = 'none';\n      });\n    }\n  }, {\n    key: 'createMedia',\n    value: function createMedia(src, type) {\n      var wrapper = document.createElement('div');\n\n      switch (type.split('/').splice(0, 1).pop()) {\n        case 'audio':\n          wrapper.innerHTML = '<audio src=\"' + src + '\" type=\"' + type + '\" controls preload></audio>';\n          break;\n\n        default:\n          wrapper.innerHTML = '<video src=\"' + src + '\" type=\"' + type + '\" controls preload playsinline></video>';\n      }\n\n      var media = wrapper.querySelector('audio, video');\n      // flow-disable-next-line\n      this.root.querySelector('header').appendChild(media);\n\n      return media;\n    }\n  }, {\n    key: 'getMedia',\n    value: function getMedia(src, type) {\n      var media = this.findMedia(src) || this.createMedia(src, type);\n\n      if (media) {\n        this.hideOtherMediaThan(src);\n        // flow-disable-next-line\n        media.style.display = '';\n      }\n\n      // flow-disable-next-line\n      if (media && !media.classList.contains('hyperaudio-enabled')) {\n        media.addEventListener('timeupdate', this.onTimeUpdate.bind(this));\n        // flow-disable-next-line\n        media.setAttribute('data-src', src);\n        // flow-disable-next-line\n        media.classList.add('hyperaudio-enabled');\n      }\n\n      return media;\n    }\n  }]);\n\n  return Player;\n}();\n\nexports.default = Player;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _player = __webpack_require__(0);\n\nvar _player2 = _interopRequireDefault(_player);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n/* eslint-disable class-methods-use-this, no-param-reassign */\n\nvar Source = function (_Player) {\n  _inherits(Source, _Player);\n\n  function Source(rootNodeOrSelector) {\n    var itemSelector = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.hyperaudio-transcript, .hyperaudio-effect';\n\n    _classCallCheck(this, Source);\n\n    var _this = _possibleConstructorReturn(this, (Source.__proto__ || Object.getPrototypeOf(Source)).call(this, rootNodeOrSelector, itemSelector));\n\n    document.addEventListener('selectionchange', _this.onSelectionChange.bind(_this));\n\n    // flow-disable-next-line\n    var collection = _this.root.querySelector(_this.itemSelector).parentNode;\n    if (collection) collection.addEventListener('mouseup', _this.onMouseUp.bind(_this));\n    return _this;\n  }\n\n  _createClass(Source, [{\n    key: 'onSelectionChange',\n    value: function onSelectionChange() {\n      var selection = window.getSelection();\n      if (selection.rangeCount === 0) return;\n\n      var range = selection.getRangeAt(0);\n      if (range.startOffset === range.endOffset) return;\n\n      var commonAncestor = range.commonAncestorContainer;\n\n      // document.TEXT_NODE\n      if (commonAncestor.nodeType === 3) {\n        range.setStartBefore(commonAncestor.parentNode);\n        return;\n      }\n\n      if (!(commonAncestor.matches('section[data-src]') || commonAncestor.parentNode.matches('section[data-src]'))) return;\n\n      this.root.querySelectorAll('.hyperaudio-selected').forEach(function (selected) {\n        if (selection.containsNode(selected, true) || selection.containsNode(selected.parentNode, true)) return;\n        selected.classList.remove('hyperaudio-selected');\n        selected.removeAttribute('draggable');\n      });\n\n      commonAncestor.querySelectorAll('*').forEach(function (candidate) {\n        // FIXME\n        if (selection.containsNode(candidate, true) && candidate.nodeName !== 'P') {\n          candidate.classList.add('hyperaudio-selected');\n        }\n      });\n    }\n  }, {\n    key: 'onMouseUp',\n    value: function onMouseUp() {\n      var _this2 = this;\n\n      var selection = window.getSelection();\n      var selected = this.root.querySelectorAll('.hyperaudio-selected');\n\n      selected.forEach(function (node) {\n        if (selection.containsNode(node, true) // ||\n        // selection.containsNode(node.parentNode, true)\n        ) {\n            node.setAttribute('draggable', 'true');\n            node.addEventListener('dragstart', _this2.onDragStart.bind(_this2));\n            node.addEventListener('dragend', _this2.onDragEnd.bind(_this2));\n          } else {\n          // console.log('kill', node);\n          node.classList.remove('hyperaudio-selected');\n          node.removeAttribute('draggable');\n        }\n      });\n\n      selection.removeAllRanges();\n\n      // if (selected.length > 0 && selection.rangeCount > 0) {\n      //   const range = selection.getRangeAt(0);\n      //   range.setStartBefore(selected.item(0));\n      //   range.setEndAfter(selected.item(selected.length - 1));\n      // } else {\n      //   selection.removeAllRanges();\n      // }\n    }\n  }, {\n    key: 'onDragStart',\n    value: function onDragStart(event) {\n      // event.preventDefault();\n      // event.stopPropagation();\n\n      var item = void 0;\n      var parent = void 0;\n      var prevSelected = void 0;\n      this.root.querySelectorAll('.hyperaudio-selected').forEach(function (selected) {\n        var clone = selected.cloneNode(true);\n        clone.classList.remove('hyperaudio-selected');\n        clone.classList.remove('hyperaudio-active');\n        clone.classList.remove('hyperaudio-past');\n        // clone.removeAttribute('class');\n        clone.removeAttribute('draggable');\n\n        // flow-disable-next-line\n        if (!item) item = selected.parentNode.parentNode.cloneNode(false);\n        if (!parent) {\n          // flow-disable-next-line\n          parent = selected.parentNode.cloneNode(false);\n          // parent.removeAttribute('class');\n          item.appendChild(parent);\n        }\n\n        if (prevSelected && prevSelected.parentNode !== selected.parentNode) {\n          // flow-disable-next-line\n          parent = selected.parentNode.cloneNode(false);\n          item.appendChild(parent);\n        }\n        parent.appendChild(clone);\n        prevSelected = selected;\n      });\n\n      // flow-disable-next-line\n      event.dataTransfer.setData('text/html', item.outerHTML);\n      // flow-disable-next-line\n      event.dataTransfer.setData('text/plain', item.innerText);\n      event.dataTransfer.effectAllowed = 'copy';\n      event.dataTransfer.dropEffect = 'copy';\n\n      // flow-disable-next-line\n      var itemClone = item.cloneNode(true);\n\n      // itemClone.style.position = 'absolute';\n      // itemClone.style.top = '0px';\n      // itemClone.style.left = '-100px';\n      // document.body.appendChild(itemClone);\n\n      // FIXME\n      this.root.appendChild(itemClone);\n      event.dataTransfer.setDragImage(itemClone, 0, 0);\n    }\n  }, {\n    key: 'onDragEnd',\n    value: function onDragEnd() {\n      this.root.querySelectorAll('.hyperaudio-selected').forEach(function (node) {\n        node.classList.remove('hyperaudio-selected');\n        node.removeAttribute('draggable');\n      });\n    }\n  }]);\n\n  return Source;\n}(_player2.default);\n\nexports.default = Source;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _player = __webpack_require__(0);\n\nvar _player2 = _interopRequireDefault(_player);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n/* eslint-disable class-methods-use-this */\n\nvar Sink = function (_Player) {\n  _inherits(Sink, _Player);\n\n  function Sink(rootNodeOrSelector) {\n    var itemSelector = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.hyperaudio-transcript, .hyperaudio-effect';\n\n    _classCallCheck(this, Sink);\n\n    // flow-disable-next-line\n    var _this = _possibleConstructorReturn(this, (Sink.__proto__ || Object.getPrototypeOf(Sink)).call(this, rootNodeOrSelector, itemSelector));\n\n    var collection = _this.root.querySelector(_this.itemSelector).parentNode;\n    if (collection) {\n      collection.addEventListener('dragover', _this.onDragOver.bind(_this));\n      collection.addEventListener('dragenter', _this.onDragEnter.bind(_this));\n      collection.addEventListener('dragend', _this.onDragEnd.bind(_this));\n      collection.addEventListener('drop', _this.onDrop.bind(_this));\n      // collection.addEventListener('dragleave', this.onDragLeave.bind(this));\n    }\n    return _this;\n  }\n\n  _createClass(Sink, [{\n    key: 'setup',\n    value: function setup(item) {\n      _get(Sink.prototype.__proto__ || Object.getPrototypeOf(Sink.prototype), 'setup', this).call(this, item);\n\n      item.setAttribute('draggable', 'true');\n      item.setAttribute('tabindex', 0);\n      item.addEventListener('dragstart', this.onDragStart.bind(this));\n      item.addEventListener('dragend', this.onDragEnd2.bind(this));\n    }\n  }, {\n    key: 'onDragStart',\n    value: function onDragStart(event) {\n      event.dataTransfer.setData('text/html', event.target.outerHTML);\n      event.dataTransfer.setData('text/plain', event.target.innerText);\n      // eslint-disable-next-line no-param-reassign\n      event.dataTransfer.effectAllowed = 'copy';\n      // eslint-disable-next-line no-param-reassign\n      event.dataTransfer.dropEffect = 'copy';\n    }\n  }, {\n    key: 'onDragEnd2',\n    value: function onDragEnd2(event) {\n      event.target.remove();\n    }\n  }, {\n    key: 'onDragOver',\n    value: function onDragOver(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      return false;\n    }\n  }, {\n    key: 'onDragEnter',\n    value: function onDragEnter(event) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      this.root.querySelectorAll('.hyperaudio-over:not(article)').forEach(function (item) {\n        return item.classList.remove('hyperaudio-over');\n      });\n\n      var target = event.target;\n      if (typeof target.matches !== 'function') return;\n      while (target && typeof target.matches === 'function' && !target.matches(this.itemSelector + '[draggable]')) {\n        // FIXME\n        target = target.parentNode;\n        if (!target) return;\n        if (typeof target.matches !== 'function') return;\n      }\n\n      target.classList.add('hyperaudio-over');\n      // flow-disable-next-line\n      this.root.querySelector('article').classList.add('hyperaudio-over');\n    }\n\n    // onDragLeave(event) {}\n\n  }, {\n    key: 'onDragEnd',\n    value: function onDragEnd() {\n      this.root.querySelectorAll('.hyperaudio-over').forEach(function (item) {\n        return item.classList.remove('hyperaudio-over');\n      });\n    }\n  }, {\n    key: 'onDrop',\n    value: function onDrop(event) {\n      event.preventDefault();\n      var html = event.dataTransfer.getData('text/html');\n\n      var target = event.target;\n\n      var wrapper = document.createElement('div');\n      wrapper.innerHTML = html;\n\n      // flow-disable-next-line\n      if (wrapper.querySelector('meta')) wrapper.querySelector('meta').remove();\n\n      var item = wrapper.children[0];\n\n      // FIXME\n      if (target.nodeName === 'DIV') target = target.parentNode;\n      if (target.nodeName === 'ARTICLE') {\n        // target.appendChild(item);\n        target.insertBefore(item, target.querySelector('div'));\n        this.setup(item);\n      } else {\n        // FIXME\n        while (target && typeof target.matches === 'function' && !target.matches(this.itemSelector + '[draggable]')) {\n          target = target.parentNode;\n        }\n\n        target.parentNode.insertBefore(item, target);\n        this.setup(item);\n      }\n\n      this.onDragEnd();\n    }\n  }]);\n\n  return Sink;\n}(_player2.default);\n\nexports.default = Sink;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(4);\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _player = __webpack_require__(0);\n\nvar _player2 = _interopRequireDefault(_player);\n\nvar _source = __webpack_require__(1);\n\nvar _source2 = _interopRequireDefault(_source);\n\nvar _sink = __webpack_require__(2);\n\nvar _sink2 = _interopRequireDefault(_sink);\n\nvar _hyperaudio = __webpack_require__(5);\n\nvar _hyperaudio2 = _interopRequireDefault(_hyperaudio);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/* eslint-disable no-new */\n\nwindow.Player = _player2.default;\nwindow.Source = _source2.default;\nwindow.Sink = _sink2.default;\n\nwindow.Hyperaudio = _hyperaudio2.default;\nif (!window.hyperaudio) window.hyperaudio = new _hyperaudio2.default();\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Sink = exports.Source = exports.Player = undefined;\n\nvar _player = __webpack_require__(0);\n\nvar _player2 = _interopRequireDefault(_player);\n\nvar _source = __webpack_require__(1);\n\nvar _source2 = _interopRequireDefault(_source);\n\nvar _sink = __webpack_require__(2);\n\nvar _sink2 = _interopRequireDefault(_sink);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n/* eslint-disable no-new */\n\nexports.Player = _player2.default;\nexports.Source = _source2.default;\nexports.Sink = _sink2.default;\n\nvar Hyperaudio = // FIXME\nfunction Hyperaudio() {\n  var rootNodeOrSelector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document;\n\n  _classCallCheck(this, Hyperaudio);\n\n  this.root = typeof rootNodeOrSelector === 'string' ? document.querySelector(rootNodeOrSelector) || rootNodeOrSelector : rootNodeOrSelector;\n\n  // flow-disable-next-line\n  this.root.querySelectorAll('.hyperaudio-source').forEach(function (sourceNode) {\n    return new _source2.default(sourceNode);\n  });\n  // flow-disable-next-line\n  this.root.querySelectorAll('.hyperaudio-sink').forEach(function (sinkNode) {\n    return new _sink2.default(sinkNode);\n  });\n  // flow-disable-next-line\n  this.root.querySelectorAll('.hyperaudio-player:not(.hyperaudio-sink):not(.hyperaudio-source)').forEach(function (playerNode) {\n    return new _player2.default(playerNode);\n  });\n};\n\nexports.default = Hyperaudio;\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// bundle.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"http://localhost:5555/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3ba3e06de3cfe0d5a75b","// @flow\n/* eslint-disable class-methods-use-this, no-unused-vars, no-plusplus, no-continue, no-param-reassign */\n\nexport default class Player {\n  root: Element;\n  itemSelector: string;\n  currentSrc: string;\n  lastSegment: Element;\n\n  constructor(\n    rootNodeOrSelector: Element | string,\n    itemSelector: string = '.hyperaudio-transcript, .hyperaudio-effect',\n  ) {\n    this.itemSelector = itemSelector;\n    this.root = typeof rootNodeOrSelector === 'string'\n      ? document.querySelector(rootNodeOrSelector) ||\n          document.createElement('section')\n      : rootNodeOrSelector;\n\n    // flow-disable-next-line\n    this.root\n      .querySelector(this.itemSelector)\n      .parentNode.querySelectorAll(this.itemSelector)\n      .forEach(item => this.setup(item));\n\n    // flow-disable-next-line\n    this.root\n      .querySelector(this.itemSelector)\n      .parentNode.addEventListener('click', this.onClick.bind(this));\n  }\n\n  setup(item: Object) {\n    const src = item.getAttribute('data-src');\n    const type = item.getAttribute('data-type');\n\n    if (src) this.getMedia(src, type);\n\n    // data-m?\n    item.querySelectorAll('*[data-m]').forEach(element => {\n      const m = element.getAttribute('data-m');\n      const d = element.getAttribute('data-d');\n      const t = [];\n\n      if (m) t.push(parseInt(m, 10) / 1000);\n      if (d) t.push(parseInt(d, 10) / 1000);\n\n      element.setAttribute('data-t', t.join(','));\n      element.removeAttribute('data-m');\n      element.removeAttribute('data-d');\n      element.removeAttribute('class');\n      element.parentNode.removeAttribute('class');\n    });\n  }\n\n  // empty() {\n  //   this.root.querySelector(this.itemSelector).parentNode.innerHTML = '';\n  //   this.root.querySelector('header').parentNode.innerHTML = '';\n  // }\n\n  onClick(event: Object) {\n    const t = event.target.getAttribute('data-t');\n    if (!t) return;\n\n    let item = event.target.parentNode;\n    while (item && !item.matches(this.itemSelector)) item = item.parentNode;\n    if (!item) return;\n\n    const src = item.getAttribute('data-src');\n    if (!src) return;\n\n    // FIXME\n    // flow-disable-next-line\n    const media = this.getMedia(src);\n    if (!media) return;\n\n    const [start, duration] = t.split(',');\n    // event.target.classList.add('hyperaudio-duration');\n\n    // flow-disable-next-line\n    media.currentTime = start;\n\n    // flow-disable-next-line\n    if (media.paused) media.play();\n  }\n\n  setHead(time: number, src: string) {\n    this.currentSrc = src;\n    let found = false;\n\n    const items = this.root.querySelectorAll(\n      `.hyperaudio-transcript[data-src=\"${src}\"]`,\n    );\n\n    for (let j = 0; j < items.length; j++) {\n      const item = items[j];\n\n      item\n        .querySelectorAll('.hyperaudio-past')\n        .forEach(active => active.classList.remove('hyperaudio-past'));\n      item\n        .querySelectorAll('.hyperaudio-active')\n        .forEach(active => active.classList.remove('hyperaudio-active'));\n\n      const candidates = item.querySelectorAll('*[data-t]');\n\n      const first = candidates[0];\n      const last = candidates[candidates.length - 1];\n\n      // flow-disable-next-line\n      const [t0] = first.getAttribute('data-t').split(',');\n      if (time < parseFloat(t0)) continue;\n\n      // flow-disable-next-line\n      const [ti, di] = last.getAttribute('data-t').split(',');\n      if (time > parseFloat(ti) + parseFloat(di)) continue;\n\n      found = true;\n      this.lastSegment = item;\n\n      for (let i = 0; i < candidates.length; i++) {\n        const tc = candidates[i].getAttribute('data-t');\n        // flow-disable-next-line\n        let [t, d] = tc.split(',');\n        t = parseFloat(t);\n        d = parseFloat(d);\n\n        if (t < time) {\n          candidates[i].classList.add('hyperaudio-past');\n        }\n\n        if (t <= time && time < t + d) {\n          // console.log(time - (t + d) * 1e3);\n          candidates[i].classList.add('hyperaudio-active');\n          if (!candidates[i].classList.contains('hyperaudio-duration'))\n            setInterval(() => {\n              candidates[i].classList.remove('hyperaudio-duration');\n            }, (d - (time - t)) * 1e3);\n          candidates[i].classList.add('hyperaudio-duration');\n        }\n\n        if (t > time) break;\n      }\n    }\n\n    if (!found) {\n      // flow-disable-next-line\n      const media = this.getMedia(src);\n      // flow-disable-next-line\n      media.pause();\n\n      const allItems = this.root.querySelectorAll('.hyperaudio-transcript');\n      for (let k = 0; k < allItems.length - 1; k++) {\n        if (allItems[k] === this.lastSegment) {\n          const event = document.createEvent('HTMLEvents');\n          event.initEvent('click', true, false);\n          // flow-disable-next-line\n          allItems[k + 1].querySelector('*[data-t]').dispatchEvent(event);\n          break;\n        }\n      }\n    }\n  }\n\n  onTimeUpdate(event: Object) {\n    const time = event.target.currentTime;\n    const src = event.target.getAttribute('data-src');\n    this.setHead(time, src);\n  }\n\n  findMedia(src: string) {\n    let media = this.root.querySelector(\n      `video[src=\"${src}\"], audio[src=\"${src}\"]`,\n    );\n    if (!media) {\n      const source = this.root.querySelector(\n        `source[src=\"${src}\"], source[src=\"${src}\"]`,\n      );\n      if (source) media = source.parentNode;\n    }\n\n    return media;\n  }\n\n  hideOtherMediaThan(src: string) {\n    this.root\n      .querySelectorAll(`video:not([src=\"${src}\"]), audio:not([src=\"${src}\"])`)\n      .forEach(media => {\n        // flow-disable-next-line\n        media.pause();\n        media.style.display = 'none';\n      });\n  }\n\n  createMedia(src: string, type: string) {\n    const wrapper = document.createElement('div');\n\n    switch (type.split('/').splice(0, 1).pop()) {\n      case 'audio':\n        wrapper.innerHTML = `<audio src=\"${src}\" type=\"${type}\" controls preload></audio>`;\n        break;\n\n      default:\n        wrapper.innerHTML = `<video src=\"${src}\" type=\"${type}\" controls preload playsinline></video>`;\n    }\n\n    const media = wrapper.querySelector('audio, video');\n    // flow-disable-next-line\n    this.root.querySelector('header').appendChild(media);\n\n    return media;\n  }\n\n  getMedia(src: string, type: string) {\n    const media = this.findMedia(src) || this.createMedia(src, type);\n\n    if (media) {\n      this.hideOtherMediaThan(src);\n      // flow-disable-next-line\n      media.style.display = '';\n    }\n\n    // flow-disable-next-line\n    if (media && !media.classList.contains('hyperaudio-enabled')) {\n      media.addEventListener('timeupdate', this.onTimeUpdate.bind(this));\n      // flow-disable-next-line\n      media.setAttribute('data-src', src);\n      // flow-disable-next-line\n      media.classList.add('hyperaudio-enabled');\n    }\n\n    return media;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/player.js","// @flow\n/* eslint-disable class-methods-use-this, no-param-reassign */\n\nimport Player from './player';\n\nexport default class Source extends Player {\n  constructor(\n    rootNodeOrSelector: Element | string,\n    itemSelector: string = '.hyperaudio-transcript, .hyperaudio-effect',\n  ) {\n    super(rootNodeOrSelector, itemSelector);\n\n    document.addEventListener(\n      'selectionchange',\n      this.onSelectionChange.bind(this),\n    );\n\n    // flow-disable-next-line\n    const collection = this.root.querySelector(this.itemSelector).parentNode;\n    if (collection)\n      collection.addEventListener('mouseup', this.onMouseUp.bind(this));\n  }\n\n  onSelectionChange() {\n    const selection = window.getSelection();\n    if (selection.rangeCount === 0) return;\n\n    const range = selection.getRangeAt(0);\n    if (range.startOffset === range.endOffset) return;\n\n    const commonAncestor = range.commonAncestorContainer;\n\n    // document.TEXT_NODE\n    if (commonAncestor.nodeType === 3) {\n      range.setStartBefore(commonAncestor.parentNode);\n      return;\n    }\n\n    if (\n      !(\n        commonAncestor.matches('section[data-src]') ||\n        commonAncestor.parentNode.matches('section[data-src]')\n      )\n    )\n      return;\n\n    this.root.querySelectorAll('.hyperaudio-selected').forEach(selected => {\n      if (\n        selection.containsNode(selected, true) ||\n        selection.containsNode(selected.parentNode, true)\n      )\n        return;\n      selected.classList.remove('hyperaudio-selected');\n      selected.removeAttribute('draggable');\n    });\n\n    commonAncestor.querySelectorAll('*').forEach(candidate => {\n      // FIXME\n      if (\n        selection.containsNode(candidate, true) &&\n        candidate.nodeName !== 'P'\n      ) {\n        candidate.classList.add('hyperaudio-selected');\n      }\n    });\n  }\n\n  onMouseUp() {\n    const selection = window.getSelection();\n    const selected = this.root.querySelectorAll('.hyperaudio-selected');\n\n    selected.forEach(node => {\n      if (\n        selection.containsNode(node, true) // ||\n        // selection.containsNode(node.parentNode, true)\n      ) {\n        node.setAttribute('draggable', 'true');\n        node.addEventListener('dragstart', this.onDragStart.bind(this));\n        node.addEventListener('dragend', this.onDragEnd.bind(this));\n      } else {\n        // console.log('kill', node);\n        node.classList.remove('hyperaudio-selected');\n        node.removeAttribute('draggable');\n      }\n    });\n\n    selection.removeAllRanges();\n\n    // if (selected.length > 0 && selection.rangeCount > 0) {\n    //   const range = selection.getRangeAt(0);\n    //   range.setStartBefore(selected.item(0));\n    //   range.setEndAfter(selected.item(selected.length - 1));\n    // } else {\n    //   selection.removeAllRanges();\n    // }\n  }\n\n  onDragStart(event: Object) {\n    // event.preventDefault();\n    // event.stopPropagation();\n\n    let item;\n    let parent;\n    let prevSelected;\n    this.root.querySelectorAll('.hyperaudio-selected').forEach(selected => {\n      const clone = selected.cloneNode(true);\n      clone.classList.remove('hyperaudio-selected');\n      clone.classList.remove('hyperaudio-active');\n      clone.classList.remove('hyperaudio-past');\n      // clone.removeAttribute('class');\n      clone.removeAttribute('draggable');\n\n      // flow-disable-next-line\n      if (!item) item = selected.parentNode.parentNode.cloneNode(false);\n      if (!parent) {\n        // flow-disable-next-line\n        parent = selected.parentNode.cloneNode(false);\n        // parent.removeAttribute('class');\n        item.appendChild(parent);\n      }\n\n      if (prevSelected && prevSelected.parentNode !== selected.parentNode) {\n        // flow-disable-next-line\n        parent = selected.parentNode.cloneNode(false);\n        item.appendChild(parent);\n      }\n      parent.appendChild(clone);\n      prevSelected = selected;\n    });\n\n    // flow-disable-next-line\n    event.dataTransfer.setData('text/html', item.outerHTML);\n    // flow-disable-next-line\n    event.dataTransfer.setData('text/plain', item.innerText);\n    event.dataTransfer.effectAllowed = 'copy';\n    event.dataTransfer.dropEffect = 'copy';\n\n    // flow-disable-next-line\n    const itemClone = item.cloneNode(true);\n\n    // itemClone.style.position = 'absolute';\n    // itemClone.style.top = '0px';\n    // itemClone.style.left = '-100px';\n    // document.body.appendChild(itemClone);\n\n    // FIXME\n    this.root.appendChild(itemClone);\n    event.dataTransfer.setDragImage(itemClone, 0, 0);\n  }\n\n  onDragEnd() {\n    this.root.querySelectorAll('.hyperaudio-selected').forEach(node => {\n      node.classList.remove('hyperaudio-selected');\n      node.removeAttribute('draggable');\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/source.js","// @flow\n/* eslint-disable class-methods-use-this */\n\nimport Player from './player';\n\nexport default class Sink extends Player {\n  constructor(\n    rootNodeOrSelector: Element | string,\n    itemSelector: string = '.hyperaudio-transcript, .hyperaudio-effect',\n  ) {\n    super(rootNodeOrSelector, itemSelector);\n\n    // flow-disable-next-line\n    const collection = this.root.querySelector(this.itemSelector).parentNode;\n    if (collection) {\n      collection.addEventListener('dragover', this.onDragOver.bind(this));\n      collection.addEventListener('dragenter', this.onDragEnter.bind(this));\n      collection.addEventListener('dragend', this.onDragEnd.bind(this));\n      collection.addEventListener('drop', this.onDrop.bind(this));\n      // collection.addEventListener('dragleave', this.onDragLeave.bind(this));\n    }\n  }\n\n  setup(item: Object) {\n    super.setup(item);\n\n    item.setAttribute('draggable', 'true');\n    item.setAttribute('tabindex', 0);\n    item.addEventListener('dragstart', this.onDragStart.bind(this));\n    item.addEventListener('dragend', this.onDragEnd2.bind(this));\n  }\n\n  onDragStart(event: Object) {\n    event.dataTransfer.setData('text/html', event.target.outerHTML);\n    event.dataTransfer.setData('text/plain', event.target.innerText);\n    // eslint-disable-next-line no-param-reassign\n    event.dataTransfer.effectAllowed = 'copy';\n    // eslint-disable-next-line no-param-reassign\n    event.dataTransfer.dropEffect = 'copy';\n  }\n\n  onDragEnd2(event: Object) {\n    event.target.remove();\n  }\n\n  onDragOver(event: Object) {\n    event.preventDefault();\n    event.stopPropagation();\n    return false;\n  }\n\n  onDragEnter(event: Object) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this.root\n      .querySelectorAll('.hyperaudio-over:not(article)')\n      .forEach(item => item.classList.remove('hyperaudio-over'));\n\n    let target = event.target;\n    if (typeof target.matches !== 'function') return;\n    while (\n      target &&\n      typeof target.matches === 'function' &&\n      !target.matches(`${this.itemSelector}[draggable]`)\n    ) {\n      // FIXME\n      target = target.parentNode;\n      if (!target) return;\n      if (typeof target.matches !== 'function') return;\n    }\n\n    target.classList.add('hyperaudio-over');\n    // flow-disable-next-line\n    this.root.querySelector('article').classList.add('hyperaudio-over');\n  }\n\n  // onDragLeave(event) {}\n\n  onDragEnd() {\n    this.root\n      .querySelectorAll('.hyperaudio-over')\n      .forEach(item => item.classList.remove('hyperaudio-over'));\n  }\n\n  onDrop(event: Object) {\n    event.preventDefault();\n    const html = event.dataTransfer.getData('text/html');\n\n    let target = event.target;\n\n    const wrapper = document.createElement('div');\n    wrapper.innerHTML = html;\n\n    // flow-disable-next-line\n    if (wrapper.querySelector('meta')) wrapper.querySelector('meta').remove();\n\n    const item = wrapper.children[0];\n\n    // FIXME\n    if (target.nodeName === 'DIV') target = target.parentNode;\n    if (target.nodeName === 'ARTICLE') {\n      // target.appendChild(item);\n      target.insertBefore(item, target.querySelector('div'));\n      this.setup(item);\n    } else {\n      // FIXME\n      while (\n        target &&\n        typeof target.matches === 'function' &&\n        !target.matches(`${this.itemSelector}[draggable]`)\n      ) {\n        target = target.parentNode;\n      }\n\n      target.parentNode.insertBefore(item, target);\n      this.setup(item);\n    }\n\n    this.onDragEnd();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/sink.js","// @flow\n/* eslint-disable no-new */\n\nimport Player from './player';\nimport Source from './source';\nimport Sink from './sink';\nimport Hyperaudio from './hyperaudio';\n\nwindow.Player = Player;\nwindow.Source = Source;\nwindow.Sink = Sink;\n\nwindow.Hyperaudio = Hyperaudio;\nif (!window.hyperaudio) window.hyperaudio = new Hyperaudio();\n\n\n\n// WEBPACK FOOTER //\n// ./src/loader.js","// @flow\n/* eslint-disable no-new */\n\nimport Player from './player';\nimport Source from './source';\nimport Sink from './sink';\n\nexport {Player, Source, Sink};\n\nexport default class Hyperaudio {\n  root: Object | string; // FIXME\n  itemSelector: string;\n  collectionSelector: string;\n\n  constructor(rootNodeOrSelector: Object | string = document) {\n    this.root = typeof rootNodeOrSelector === 'string'\n      ? document.querySelector(rootNodeOrSelector) || rootNodeOrSelector\n      : rootNodeOrSelector;\n\n    // flow-disable-next-line\n    this.root\n      .querySelectorAll('.hyperaudio-source')\n      .forEach(sourceNode => new Source(sourceNode));\n    // flow-disable-next-line\n    this.root\n      .querySelectorAll('.hyperaudio-sink')\n      .forEach(sinkNode => new Sink(sinkNode));\n    // flow-disable-next-line\n    this.root\n      .querySelectorAll(\n        '.hyperaudio-player:not(.hyperaudio-sink):not(.hyperaudio-source)',\n      )\n      .forEach(playerNode => new Player(playerNode));\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/hyperaudio.js"],"sourceRoot":""}