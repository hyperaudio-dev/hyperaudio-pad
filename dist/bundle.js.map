{"version":3,"sources":["webpack:///bundle.js","webpack:///webpack/bootstrap abdc6fc9c42ed17d1730","webpack:///./src/player.js","webpack:///./src/loader.js","webpack:///./src/hyperaudio.js","webpack:///./src/source.js","webpack:///./src/sink.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_classCallCheck","instance","Constructor","TypeError","value","_createClass","defineProperties","target","props","length","descriptor","writable","key","protoProps","staticProps","Player","rootNodeOrSelector","_this","this","itemSelector","arguments","undefined","root","document","querySelector","createElement","parentNode","querySelectorAll","forEach","item","setup","src","getAttribute","type","console","log","getMedia","media","source","wrapper","split","splice","pop","innerHTML","findMedia","createMedia","appendChild","default","_hyperaudio","obj","_interopRequireDefault","_player","_player2","_source","_source2","_sink","_sink2","Hyperaudio","sourceNode","sinkNode","playerNode","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","Source","_Player","getPrototypeOf","addEventListener","onSelectionChange","bind","onMouseUp","selection","window","getSelection","rangeCount","range","getRangeAt","commonAncestor","commonAncestorContainer","nodeType","setStartBefore","matches","selected","containsNode","classList","remove","removeAttribute","candidate","nodeName","add","_this2","node","setAttribute","onDragStart","setEndAfter","removeAllRanges","parent","prevSelected","clone","cloneNode","event","dataTransfer","setData","outerHTML","effectAllowed","dropEffect","_get","receiver","Function","desc","getOwnPropertyDescriptor","Sink","collection","onDragOver","onDragEnter","onDragEnd","onDrop","onDragEnd2","preventDefault","stopPropagation","html","getData","children","insertBefore"],"mappings":"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","file":"bundle.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"http://localhost:5555/dist/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 1);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* eslint-disable class-methods-use-this, no-unused-vars */\n\nvar Player = function () {\n  function Player(rootNodeOrSelector) {\n    var _this = this;\n\n    var itemSelector = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.hyperaudio-transcript, .hyperaudio-effect';\n\n    _classCallCheck(this, Player);\n\n    this.itemSelector = itemSelector;\n    this.root = typeof rootNodeOrSelector === 'string' ? document.querySelector(rootNodeOrSelector) || document.createElement('section') : rootNodeOrSelector;\n\n    // flow-disable-next-line\n    this.root.querySelector(this.itemSelector).parentNode.querySelectorAll(this.itemSelector).forEach(function (item) {\n      return _this.setup(item);\n    });\n  }\n\n  _createClass(Player, [{\n    key: 'setup',\n    value: function setup(item) {\n      var src = item.getAttribute('data-src');\n      var type = item.getAttribute('data-type');\n\n      if (src) console.log(this.getMedia(src, type));\n    }\n  }, {\n    key: 'findMedia',\n    value: function findMedia(src) {\n      var media = this.root.querySelector('video[src=\"' + src + '\"], audio[src=\"' + src + '\"]');\n      if (!media) {\n        var source = this.root.querySelector('source[src=\"' + src + '\"], source[src=\"' + src + '\"]');\n        if (source) media = source.parentNode;\n      }\n      return media;\n    }\n  }, {\n    key: 'createMedia',\n    value: function createMedia(src, type) {\n      var wrapper = document.createElement('div');\n\n      switch (type.split('/').splice(0, 1).pop()) {\n        case 'audio':\n          wrapper.innerHTML = '<audio src=\"' + src + '\" type=\"' + type + '\" controls preload></audio>';\n          break;\n\n        default:\n          wrapper.innerHTML = '<video src=\"' + src + '\" type=\"' + type + '\" controls preload></video>';\n      }\n\n      return wrapper.querySelector('audio, video');\n    }\n  }, {\n    key: 'getMedia',\n    value: function getMedia(src, type) {\n      var media = this.findMedia(src) || this.createMedia(src, type);\n\n      // flow-disable-next-line\n      this.root.querySelector('header').appendChild(media);\n\n      return media;\n    }\n  }]);\n\n  return Player;\n}();\n\nexports.default = Player;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(2);\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _hyperaudio = __webpack_require__(3);\n\nvar _hyperaudio2 = _interopRequireDefault(_hyperaudio);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nnew _hyperaudio2.default();\n/* eslint-disable no-new */\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _player = __webpack_require__(0);\n\nvar _player2 = _interopRequireDefault(_player);\n\nvar _source = __webpack_require__(4);\n\nvar _source2 = _interopRequireDefault(_source);\n\nvar _sink = __webpack_require__(5);\n\nvar _sink2 = _interopRequireDefault(_sink);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n/* eslint-disable no-new */\n\nvar Hyperaudio = // FIXME\nfunction Hyperaudio() {\n  var rootNodeOrSelector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document;\n\n  _classCallCheck(this, Hyperaudio);\n\n  this.root = typeof rootNodeOrSelector === 'string' ? document.querySelector(rootNodeOrSelector) || rootNodeOrSelector : rootNodeOrSelector;\n\n  // flow-disable-next-line\n  this.root.querySelectorAll('.hyperaudio-source').forEach(function (sourceNode) {\n    return new _source2.default(sourceNode);\n  });\n  // flow-disable-next-line\n  this.root.querySelectorAll('.hyperaudio-sink').forEach(function (sinkNode) {\n    return new _sink2.default(sinkNode);\n  });\n  // flow-disable-next-line\n  this.root.querySelectorAll('.hyperaudio-player:not(.hyperaudio-sink):not(.hyperaudio-source)').forEach(function (playerNode) {\n    return new _player2.default(playerNode);\n  });\n};\n\nexports.default = Hyperaudio;\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _player = __webpack_require__(0);\n\nvar _player2 = _interopRequireDefault(_player);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n/* eslint-disable class-methods-use-this */\n\nvar Source = function (_Player) {\n  _inherits(Source, _Player);\n\n  function Source(rootNodeOrSelector) {\n    var itemSelector = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.hyperaudio-transcript, .hyperaudio-effect';\n\n    _classCallCheck(this, Source);\n\n    var _this = _possibleConstructorReturn(this, (Source.__proto__ || Object.getPrototypeOf(Source)).call(this, rootNodeOrSelector, itemSelector));\n\n    document.addEventListener('selectionchange', _this.onSelectionChange.bind(_this));\n    document.addEventListener('mouseup', _this.onMouseUp.bind(_this));\n    return _this;\n  }\n\n  _createClass(Source, [{\n    key: 'onSelectionChange',\n    value: function onSelectionChange() {\n      var selection = window.getSelection();\n      if (selection.rangeCount === 0) return;\n\n      var range = selection.getRangeAt(0);\n      var commonAncestor = range.commonAncestorContainer;\n\n      // document.TEXT_NODE\n      if (commonAncestor.nodeType === 3) {\n        range.setStartBefore(commonAncestor.parentNode);\n        return;\n      }\n\n      if (!(commonAncestor.matches('section[data-src]') || commonAncestor.parentNode.matches('section[data-src]'))) return;\n\n      this.root.querySelectorAll('.selected').forEach(function (selected) {\n        if (selection.containsNode(selected, true) || selection.containsNode(selected.parentNode, true)) return;\n        selected.classList.remove('selected');\n        selected.removeAttribute('draggable');\n      });\n\n      commonAncestor.querySelectorAll('*').forEach(function (candidate) {\n        // FIXME\n        if (selection.containsNode(candidate, true) && candidate.nodeName !== 'P') {\n          candidate.classList.add('selected');\n        }\n      });\n    }\n  }, {\n    key: 'onMouseUp',\n    value: function onMouseUp() {\n      var _this2 = this;\n\n      var selection = window.getSelection();\n      var selected = this.root.querySelectorAll('.selected');\n\n      selected.forEach(function (node) {\n        if (selection.containsNode(node, true) || selection.containsNode(node.parentNode, true)) {\n          node.setAttribute('draggable', 'true');\n          node.addEventListener('dragstart', _this2.onDragStart.bind(_this2));\n          // node.addEventListener('dragend', this.onDragEnd.bind(this));\n        } else {\n          // console.log('kill', node);\n          node.classList.remove('selected');\n          node.removeAttribute('draggable');\n        }\n      });\n\n      if (selected.length > 0 && selection.rangeCount > 0) {\n        var range = selection.getRangeAt(0);\n        range.setStartBefore(selected.item(0));\n        range.setEndAfter(selected.item(selected.length - 1));\n      } else {\n        selection.removeAllRanges();\n      }\n    }\n  }, {\n    key: 'onDragStart',\n    value: function onDragStart() /* event) */{\n      // event.preventDefault();\n      // event.stopPropagation();\n\n      var item = void 0;\n      var parent = void 0;\n      var prevSelected = void 0;\n      this.root.querySelectorAll('.selected').forEach(function (selected) {\n        var clone = selected.cloneNode(true);\n        clone.classList.remove('selected');\n        clone.removeAttribute('draggable');\n\n        // flow-disable-next-line\n        if (!item) item = selected.parentNode.parentNode.cloneNode(false);\n        // flow-disable-next-line\n        if (!parent) {\n          parent = selected.parentNode.cloneNode(false);\n          item.appendChild(parent);\n        }\n\n        if (prevSelected && prevSelected.parentNode !== selected.parentNode) {\n          // flow-disable-next-line\n          parent = selected.parentNode.cloneNode(false);\n          item.appendChild(parent);\n        }\n        parent.appendChild(clone);\n        prevSelected = selected;\n      });\n\n      // flow-disable-next-line\n      event.dataTransfer.setData('html', item.outerHTML);\n      // eslint-disable-next-line no-param-reassign flow-disable-next-line\n      event.dataTransfer.effectAllowed = 'copy';\n      // eslint-disable-next-line no-param-reassign flow-disable-next-line\n      event.dataTransfer.dropEffect = 'copy';\n\n      // return false;\n    }\n\n    // onDragEnd() {\n    //   for (const node of this.node.querySelectorAll('.selected')) {\n    //     node.classList.remove('selected');\n    //     node.removeAttribute('draggable');\n    //   }\n    // }\n\n  }]);\n\n  return Source;\n}(_player2.default);\n\nexports.default = Source;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _player = __webpack_require__(0);\n\nvar _player2 = _interopRequireDefault(_player);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n/* eslint-disable class-methods-use-this */\n\nvar Sink = function (_Player) {\n  _inherits(Sink, _Player);\n\n  function Sink(rootNodeOrSelector) {\n    var itemSelector = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.hyperaudio-transcript, .hyperaudio-effect';\n\n    _classCallCheck(this, Sink);\n\n    // flow-disable-next-line\n    var _this = _possibleConstructorReturn(this, (Sink.__proto__ || Object.getPrototypeOf(Sink)).call(this, rootNodeOrSelector, itemSelector));\n\n    var collection = _this.root.querySelector(_this.itemSelector).parentNode;\n    if (collection) {\n      collection.addEventListener('dragover', _this.onDragOver.bind(_this));\n      collection.addEventListener('dragenter', _this.onDragEnter.bind(_this));\n      collection.addEventListener('dragend', _this.onDragEnd.bind(_this));\n      collection.addEventListener('drop', _this.onDrop.bind(_this));\n      // collection.addEventListener('dragleave', this.onDragLeave.bind(this));\n    }\n    return _this;\n  }\n\n  _createClass(Sink, [{\n    key: 'setup',\n    value: function setup(item) {\n      _get(Sink.prototype.__proto__ || Object.getPrototypeOf(Sink.prototype), 'setup', this).call(this, item);\n\n      item.setAttribute('draggable', 'true');\n      item.setAttribute('tabindex', 0);\n      item.addEventListener('dragstart', this.onDragStart.bind(this));\n      item.addEventListener('dragend', this.onDragEnd2.bind(this));\n    }\n  }, {\n    key: 'onDragStart',\n    value: function onDragStart(event) {\n      event.dataTransfer.setData('html', event.target.outerHTML);\n      // eslint-disable-next-line no-param-reassign\n      event.dataTransfer.effectAllowed = 'copy';\n      // eslint-disable-next-line no-param-reassign\n      event.dataTransfer.dropEffect = 'copy';\n    }\n  }, {\n    key: 'onDragEnd2',\n    value: function onDragEnd2(event) {\n      event.target.remove();\n    }\n  }, {\n    key: 'onDragOver',\n    value: function onDragOver(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      return false;\n    }\n  }, {\n    key: 'onDragEnter',\n    value: function onDragEnter(event) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      this.root.querySelectorAll('.over').forEach(function (item) {\n        return item.classList.remove('over');\n      });\n\n      var target = event.target;\n      if (typeof target.matches !== 'function') return;\n      while (target && typeof target.matches === 'function' && !target.matches(this.itemSelector + '[draggable]')) {\n        // FIXME\n        target = target.parentNode;\n        if (!target) return;\n        if (typeof target.matches !== 'function') return;\n      }\n\n      target.classList.add('over');\n    }\n\n    // onDragLeave(event) {}\n\n  }, {\n    key: 'onDragEnd',\n    value: function onDragEnd() {\n      this.root.querySelectorAll('.over').forEach(function (item) {\n        return item.classList.remove('over');\n      });\n    }\n  }, {\n    key: 'onDrop',\n    value: function onDrop(event) {\n      event.preventDefault();\n      var html = event.dataTransfer.getData('html');\n      console.log(html);\n\n      var target = event.target;\n\n      var wrapper = document.createElement('div');\n      wrapper.innerHTML = html;\n      var item = wrapper.children[0];\n\n      // FIXME\n      if (target.nodeName === 'ARTICLE') {\n        target.appendChild(item);\n        this.setup(item);\n      } else {\n        // FIXME\n        while (target && typeof target.matches === 'function' && !target.matches(this.itemSelector + '[draggable]')) {\n          target = target.parentNode;\n        }\n\n        target.parentNode.insertBefore(item, target);\n        this.setup(item);\n      }\n\n      this.onDragEnd();\n    }\n  }]);\n\n  return Sink;\n}(_player2.default);\n\nexports.default = Sink;\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// bundle.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"http://localhost:5555/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap abdc6fc9c42ed17d1730","// @flow\n/* eslint-disable class-methods-use-this, no-unused-vars */\n\nexport default class Player {\n  root: Element;\n  itemSelector: string;\n\n  constructor(\n    rootNodeOrSelector: Element | string,\n    itemSelector: string = '.hyperaudio-transcript, .hyperaudio-effect',\n  ) {\n    this.itemSelector = itemSelector;\n    this.root = typeof rootNodeOrSelector === 'string'\n      ? document.querySelector(rootNodeOrSelector) ||\n          document.createElement('section')\n      : rootNodeOrSelector;\n\n    // flow-disable-next-line\n    this.root\n      .querySelector(this.itemSelector)\n      .parentNode.querySelectorAll(this.itemSelector)\n      .forEach(item => this.setup(item));\n  }\n\n  setup(item: Object) {\n    const src = item.getAttribute('data-src');\n    const type = item.getAttribute('data-type');\n\n    if (src) console.log(this.getMedia(src, type));\n  }\n\n  findMedia(src: string) {\n    let media = this.root.querySelector(\n      `video[src=\"${src}\"], audio[src=\"${src}\"]`,\n    );\n    if (!media) {\n      const source = this.root.querySelector(\n        `source[src=\"${src}\"], source[src=\"${src}\"]`,\n      );\n      if (source) media = source.parentNode;\n    }\n    return media;\n  }\n\n  createMedia(src: string, type: string) {\n    const wrapper = document.createElement('div');\n\n    switch (type.split('/').splice(0, 1).pop()) {\n      case 'audio':\n        wrapper.innerHTML = `<audio src=\"${src}\" type=\"${type}\" controls preload></audio>`;\n        break;\n\n      default:\n        wrapper.innerHTML = `<video src=\"${src}\" type=\"${type}\" controls preload></video>`;\n    }\n\n    return wrapper.querySelector('audio, video');\n  }\n\n  getMedia(src: string, type: string) {\n    const media = this.findMedia(src) || this.createMedia(src, type);\n\n    // flow-disable-next-line\n    this.root.querySelector('header').appendChild(media);\n\n    return media;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/player.js","// @flow\n/* eslint-disable no-new */\n\nimport Hyperaudio from './hyperaudio';\n\nnew Hyperaudio();\n\n\n\n// WEBPACK FOOTER //\n// ./src/loader.js","// @flow\n/* eslint-disable no-new */\n\nimport Player from './player';\nimport Source from './source';\nimport Sink from './sink';\n\nexport default class Hyperaudio {\n  root: Object | string; // FIXME\n  itemSelector: string;\n  collectionSelector: string;\n\n  constructor(rootNodeOrSelector: Object | string = document) {\n    this.root = typeof rootNodeOrSelector === 'string'\n      ? document.querySelector(rootNodeOrSelector) || rootNodeOrSelector\n      : rootNodeOrSelector;\n\n    // flow-disable-next-line\n    this.root\n      .querySelectorAll('.hyperaudio-source')\n      .forEach(sourceNode => new Source(sourceNode));\n    // flow-disable-next-line\n    this.root\n      .querySelectorAll('.hyperaudio-sink')\n      .forEach(sinkNode => new Sink(sinkNode));\n    // flow-disable-next-line\n    this.root\n      .querySelectorAll(\n        '.hyperaudio-player:not(.hyperaudio-sink):not(.hyperaudio-source)',\n      )\n      .forEach(playerNode => new Player(playerNode));\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/hyperaudio.js","// @flow\n/* eslint-disable class-methods-use-this */\n\nimport Player from './player';\n\nexport default class Source extends Player {\n  constructor(\n    rootNodeOrSelector: Element | string,\n    itemSelector: string = '.hyperaudio-transcript, .hyperaudio-effect',\n  ) {\n    super(rootNodeOrSelector, itemSelector);\n\n    document.addEventListener(\n      'selectionchange',\n      this.onSelectionChange.bind(this),\n    );\n    document.addEventListener('mouseup', this.onMouseUp.bind(this));\n  }\n\n  onSelectionChange() {\n    const selection = window.getSelection();\n    if (selection.rangeCount === 0) return;\n\n    const range = selection.getRangeAt(0);\n    const commonAncestor = range.commonAncestorContainer;\n\n    // document.TEXT_NODE\n    if (commonAncestor.nodeType === 3) {\n      range.setStartBefore(commonAncestor.parentNode);\n      return;\n    }\n\n    if (\n      !(\n        commonAncestor.matches('section[data-src]') ||\n        commonAncestor.parentNode.matches('section[data-src]')\n      )\n    )\n      return;\n\n    this.root.querySelectorAll('.selected').forEach(selected => {\n      if (\n        selection.containsNode(selected, true) ||\n        selection.containsNode(selected.parentNode, true)\n      )\n        return;\n      selected.classList.remove('selected');\n      selected.removeAttribute('draggable');\n    });\n\n    commonAncestor.querySelectorAll('*').forEach(candidate => {\n      // FIXME\n      if (\n        selection.containsNode(candidate, true) &&\n        candidate.nodeName !== 'P'\n      ) {\n        candidate.classList.add('selected');\n      }\n    });\n  }\n\n  onMouseUp() {\n    const selection = window.getSelection();\n    const selected = this.root.querySelectorAll('.selected');\n\n    selected.forEach(node => {\n      if (\n        selection.containsNode(node, true) ||\n        selection.containsNode(node.parentNode, true)\n      ) {\n        node.setAttribute('draggable', 'true');\n        node.addEventListener('dragstart', this.onDragStart.bind(this));\n        // node.addEventListener('dragend', this.onDragEnd.bind(this));\n      } else {\n        // console.log('kill', node);\n        node.classList.remove('selected');\n        node.removeAttribute('draggable');\n      }\n    });\n\n    if (selected.length > 0 && selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0);\n      range.setStartBefore(selected.item(0));\n      range.setEndAfter(selected.item(selected.length - 1));\n    } else {\n      selection.removeAllRanges();\n    }\n  }\n\n  onDragStart(/* event) */) {\n    // event.preventDefault();\n    // event.stopPropagation();\n\n    let item;\n    let parent;\n    let prevSelected;\n    this.root.querySelectorAll('.selected').forEach(selected => {\n      const clone = selected.cloneNode(true);\n      clone.classList.remove('selected');\n      clone.removeAttribute('draggable');\n\n      // flow-disable-next-line\n      if (!item) item = selected.parentNode.parentNode.cloneNode(false);\n      // flow-disable-next-line\n      if (!parent) {\n        parent = selected.parentNode.cloneNode(false);\n        item.appendChild(parent);\n      }\n\n      if (prevSelected && prevSelected.parentNode !== selected.parentNode) {\n        // flow-disable-next-line\n        parent = selected.parentNode.cloneNode(false);\n        item.appendChild(parent);\n      }\n      parent.appendChild(clone);\n      prevSelected = selected;\n    });\n\n    // flow-disable-next-line\n    event.dataTransfer.setData('html', item.outerHTML);\n    // eslint-disable-next-line no-param-reassign flow-disable-next-line\n    event.dataTransfer.effectAllowed = 'copy';\n    // eslint-disable-next-line no-param-reassign flow-disable-next-line\n    event.dataTransfer.dropEffect = 'copy';\n\n    // return false;\n  }\n\n  // onDragEnd() {\n  //   for (const node of this.node.querySelectorAll('.selected')) {\n  //     node.classList.remove('selected');\n  //     node.removeAttribute('draggable');\n  //   }\n  // }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/source.js","// @flow\n/* eslint-disable class-methods-use-this */\n\nimport Player from './player';\n\nexport default class Sink extends Player {\n  constructor(\n    rootNodeOrSelector: Element | string,\n    itemSelector: string = '.hyperaudio-transcript, .hyperaudio-effect',\n  ) {\n    super(rootNodeOrSelector, itemSelector);\n\n    // flow-disable-next-line\n    const collection = this.root.querySelector(this.itemSelector).parentNode;\n    if (collection) {\n      collection.addEventListener('dragover', this.onDragOver.bind(this));\n      collection.addEventListener('dragenter', this.onDragEnter.bind(this));\n      collection.addEventListener('dragend', this.onDragEnd.bind(this));\n      collection.addEventListener('drop', this.onDrop.bind(this));\n      // collection.addEventListener('dragleave', this.onDragLeave.bind(this));\n    }\n  }\n\n  setup(item: Object) {\n    super.setup(item);\n\n    item.setAttribute('draggable', 'true');\n    item.setAttribute('tabindex', 0);\n    item.addEventListener('dragstart', this.onDragStart.bind(this));\n    item.addEventListener('dragend', this.onDragEnd2.bind(this));\n  }\n\n  onDragStart(event: Object) {\n    event.dataTransfer.setData('html', event.target.outerHTML);\n    // eslint-disable-next-line no-param-reassign\n    event.dataTransfer.effectAllowed = 'copy';\n    // eslint-disable-next-line no-param-reassign\n    event.dataTransfer.dropEffect = 'copy';\n  }\n\n  onDragEnd2(event: Object) {\n    event.target.remove();\n  }\n\n  onDragOver(event: Object) {\n    event.preventDefault();\n    event.stopPropagation();\n    return false;\n  }\n\n  onDragEnter(event: Object) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this.root\n      .querySelectorAll('.over')\n      .forEach(item => item.classList.remove('over'));\n\n    let target = event.target;\n    if (typeof target.matches !== 'function') return;\n    while (\n      target &&\n      typeof target.matches === 'function' &&\n      !target.matches(`${this.itemSelector}[draggable]`)\n    ) {\n      // FIXME\n      target = target.parentNode;\n      if (!target) return;\n      if (typeof target.matches !== 'function') return;\n    }\n\n    target.classList.add('over');\n  }\n\n  // onDragLeave(event) {}\n\n  onDragEnd() {\n    this.root\n      .querySelectorAll('.over')\n      .forEach(item => item.classList.remove('over'));\n  }\n\n  onDrop(event: Object) {\n    event.preventDefault();\n    const html = event.dataTransfer.getData('html');\n    console.log(html);\n\n    let target = event.target;\n\n    const wrapper = document.createElement('div');\n    wrapper.innerHTML = html;\n    const item = wrapper.children[0];\n\n    // FIXME\n    if (target.nodeName === 'ARTICLE') {\n      target.appendChild(item);\n      this.setup(item);\n    } else {\n      // FIXME\n      while (\n        target &&\n        typeof target.matches === 'function' &&\n        !target.matches(`${this.itemSelector}[draggable]`)\n      ) {\n        target = target.parentNode;\n      }\n\n      target.parentNode.insertBefore(item, target);\n      this.setup(item);\n    }\n\n    this.onDragEnd();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/sink.js"],"sourceRoot":""}